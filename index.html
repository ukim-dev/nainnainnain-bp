<!DOCTYPE html>
<html lang="et">
<head>
  <meta charset="UTF-8" />
  <title>ARC Raiders – Blueprintide tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #05060a;
      --bg-alt: #0f1117;
      --accent: #4ade80;
      --accent-soft: rgba(74, 222, 128, 0.12);
      --accent-strong: rgba(74, 222, 128, 0.25);
      --danger: #f97373;
      --text: #f9fafb;
      --muted: #9ca3af;
      --border: #1f2933;
      --card-radius: 16px;
      --shadow-soft: 0 14px 35px rgba(0, 0, 0, 0.5);
      --transition-fast: 0.18s ease-out;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 50%, #000 100%);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 24px 12px 40px;
    }

    .app {
      width: 100%;
      max-width: 1120px;
      background: linear-gradient(145deg, #020617, #020617 40%, #020617 100%);
      border-radius: 24px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      box-shadow: var(--shadow-soft);
      padding: 20px 20px 24px;
      position: relative;
      overflow: hidden;
    }

    .app::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 10% 0, rgba(56, 189, 248, 0.18), transparent 55%),
        radial-gradient(circle at 90% 0, rgba(74, 222, 128, 0.18), transparent 55%);
      opacity: 0.45;
      pointer-events: none;
      z-index: -1;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 22px;
    }

    .title-group h1 {
      font-size: 1.6rem;
      margin: 0 0 6px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .tag {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--muted);
      background: rgba(15, 23, 42, 0.7);
    }

    .subtitle {
      margin: 0;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .pill-stats {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .pill {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--muted);
      background: rgba(15, 23, 42, 0.7);
    }

    .pill strong {
      color: var(--accent);
      font-weight: 600;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 2fr);
      gap: 16px;
    }

    @media (max-width: 880px) {
      .layout {
        grid-template-columns: 1fr;
      }
      header {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    .panel {
      background: radial-gradient(circle at top left, #020617, #020617);
      border-radius: 20px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      padding: 14px 14px 16px;
      backdrop-filter: blur(16px);
    }

    .panel h2 {
      margin: 0 0 10px;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .panel h2 span {
      font-size: 0.75rem;
      color: var(--muted);
      font-weight: 400;
    }

    form {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 10px;
      font-size: 0.88rem;
    }

    .field-row {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 10px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--muted);
    }

    input[type="text"],
    select,
    textarea {
      border-radius: 999px;
      padding: 8px 11px;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.92);
      color: var(--text);
      font: inherit;
      outline: none;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast),
        background var(--transition-fast), transform var(--transition-fast);
    }

    textarea {
      border-radius: 14px;
      min-height: 60px;
      resize: vertical;
    }

    input::placeholder,
    textarea::placeholder {
      color: #6b7280;
      font-size: 0.82rem;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
      background: #020617;
      transform: translateY(-0.5px);
    }

    select {
      appearance: none;
      padding-right: 26px;
      background-image: linear-gradient(45deg, transparent 50%, #6b7280 50%),
        linear-gradient(135deg, #6b7280 50%, transparent 50%);
      background-position: calc(100% - 13px) 12px, calc(100% - 8px) 12px;
      background-size: 5px 5px, 5px 5px;
      background-repeat: no-repeat;
    }

    .actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 2px;
      flex-wrap: wrap;
    }

    .actions-left {
      font-size: 0.7rem;
      color: var(--muted);
    }

    button {
      border: none;
      cursor: pointer;
      font: inherit;
    }

    .btn-primary {
      padding: 8px 16px;
      border-radius: 999px;
      background: radial-gradient(circle at top, var(--accent), #22c55e);
      color: #022c22;
      font-size: 0.82rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 8px 20px rgba(34, 197, 94, 0.4);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast),
        filter var(--transition-fast);
    }

    .btn-primary span {
      font-size: 0.9rem;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 30px rgba(34, 197, 94, 0.6);
      filter: brightness(1.03);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 5px 12px rgba(34, 197, 94, 0.3);
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }

    .filters-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filters label {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--muted);
    }

    .filters input[type="text"],
    .filters select {
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 0.78rem;
    }

    .filters .search {
      min-width: 160px;
      flex: 1 1 160px;
    }

    .filters .select-small {
      font-size: 0.78rem;
    }

    .list-panel {
      display: flex;
      flex-direction: column;
      min-height: 260px;
    }

    .blueprint-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
      gap: 10px;
      margin-top: 6px;
    }

    .card {
      position: relative;
      border-radius: var(--card-radius);
      padding: 10px 10px 12px;
      background: radial-gradient(circle at top left, #020617, #020617 60%, #020617 100%);
      border: 1px solid rgba(51, 65, 85, 0.85);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.8);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      gap: 5px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast),
        border-color var(--transition-fast), background var(--transition-fast);
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 10% 0, rgba(148, 163, 184, 0.13), transparent 45%),
        radial-gradient(circle at 90% 0, rgba(15, 23, 42, 0.65), transparent 45%);
      opacity: 0.7;
      pointer-events: none;
      z-index: -1;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 38px rgba(15, 23, 42, 0.95);
      border-color: var(--accent-strong);
      background: radial-gradient(circle at top left, #020617, #020617 50%, #020617 100%);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 6px;
    }

    .bp-name {
      font-size: 0.92rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .bp-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 1px;
    }

    .bp-chip {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--muted);
      background: rgba(15, 23, 42, 0.7);
    }

    .bp-chip.rarity-common {
      border-color: #6b7280;
      color: #9ca3af;
    }
    .bp-chip.rarity-rare {
      border-color: #3b82f6;
      color: #bfdbfe;
    }
    .bp-chip.rarity-epic {
      border-color: #a855f7;
      color: #e9d5ff;
    }
    .bp-chip.rarity-legendary {
      border-color: #f59e0b;
      color: #fed7aa;
    }

    .status-pill {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      padding: 3px 8px;
      border-radius: 999px;
      border-width: 1px;
      border-style: solid;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(15, 23, 42, 0.9);
    }

    .status-have {
      color: #bbf7d0;
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.2);
    }

    .status-want {
      color: #e0f2fe;
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.2);
    }

    .status-trade {
      color: #fee2e2;
      border-color: #fb7185;
      box-shadow: 0 0 0 1px rgba(248, 113, 113, 0.25);
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: currentColor;
      opacity: 0.9;
    }

    .bp-notes {
      font-size: 0.78rem;
      color: #e5e7eb;
      margin-top: 4px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .bp-notes.empty {
      color: var(--muted);
      font-style: italic;
    }

    .bp-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
      gap: 6px;
      font-size: 0.72rem;
    }

    .owner {
      color: var(--muted);
    }

    .owner strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .card-actions {
      display: inline-flex;
      gap: 4px;
    }

    .btn-ghost {
      padding: 3px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.85);
      color: var(--muted);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background var(--transition-fast),
        border-color var(--transition-fast), color var(--transition-fast),
        transform var(--transition-fast);
    }

    .btn-ghost:hover {
      background: rgba(30, 64, 175, 0.85);
      border-color: rgba(191, 219, 254, 0.8);
      color: #e5e7eb;
      transform: translateY(-0.5px);
    }

    .btn-danger {
      border-color: rgba(248, 113, 113, 0.7);
      color: #fecaca;
    }

    .btn-danger:hover {
      background: rgba(127, 29, 29, 0.9);
      border-color: rgba(248, 113, 113, 0.9);
      color: #fee2e2;
    }

    .empty-state {
      margin-top: 32px;
      text-align: center;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .empty-state span {
      display: inline-block;
      margin-bottom: 8px;
      font-size: 1.6rem;
    }

    footer {
      margin-top: 10px;
      font-size: 0.7rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 8px;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title-group">
        <h1>
          ARC RAIDERS
          <span class="tag">Blueprintide vahetus • ühine nimekiri</span>
        </h1>
        <p class="subtitle">
          Ühine ARC Raiders blueprintide nimekiri – mida keegi omab, mida otsib ja mida on valmis vahetama.
        </p>
      </div>
      <div class="pill-stats">
        <div class="pill">
          KOKKU: <strong id="statTotal">0</strong>
        </div>
        <div class="pill">
          ON: <strong id="statHave">0</strong>
        </div>
        <div class="pill">
          OTSIVAD: <strong id="statWant">0</strong>
        </div>
        <div class="pill">
          VAHETUSEKS: <strong id="statTrade">0</strong>
        </div>
      </div>
    </header>

    <div class="layout">
      <!-- Vasak: lisamine -->
      <section class="panel">
        <h2>
          Lisa blueprint
          <span>Salvestatakse ühisesse Firestore andmebaasi</span>
        </h2>
        <form id="blueprintForm">
          <div class="field-row">
            <div class="field">
              <label for="name">Blueprinti nimi</label>
              <input
                list="blueprintNames"
                id="name"
                type="text"
                placeholder="Näide: Anvil Blueprint"
                required
              />
              <datalist id="blueprintNames"></datalist>
            </div>
          </div>

          <div class="field-row">
            <div class="field">
              <label for="rarity">Haruldus</label>
              <select id="rarity">
                <option value="common">Tavaline</option>
                <option value="rare">Haruldane</option>
                <option value="epic">Eepiline</option>
                <option value="legendary">Legendaarne</option>
              </select>
            </div>
            <div class="field">
              <label for="status">Olek</label>
              <select id="status">
                <option value="have">Mul olemas (võin vahetada)</option>
                <option value="want">Otsin</option>
                <option value="trade">Ülejääk / ainult vahetus</option>
              </select>
            </div>
          </div>

          <div class="field-row">
            <div class="field">
              <label for="owner">Kasutaja</label>
              <input
                id="owner"
                type="text"
                placeholder="Näide: Mihkel / Discord: Raider#9999"
              />
            </div>
          </div>

          <div class="field">
            <label for="notes">Märkmed</label>
            <textarea
              id="notes"
              placeholder="Kust leidsid, millega kaupled, rollid jne."
            ></textarea>
          </div>

          <div class="actions">
            <div class="actions-left">
              Kõik muudatused on <strong>ühised</strong> – sama lehte kasutavad näevad sama nimekirja.
            </div>
            <button type="submit" class="btn-primary">
              <span>＋</span> LISA BLUEPRINT
            </button>
          </div>
        </form>
      </section>

      <!-- Parem: filtrid ja list -->
      <section class="panel list-panel">
        <h2>
          Ühine nimekiri
          <span>Filtreeri ja otsi vahetuste jaoks</span>
        </h2>

        <div class="filters">
          <div class="filters-group search">
            <input
              id="filterSearch"
              type="text"
              placeholder="Otsi nime, märkmete või kasutaja järgi…"
            />
          </div>
          <div class="filters-group">
            <label for="filterStatus">Olek</label>
            <select id="filterStatus" class="select-small">
              <option value="all">Kõik</option>
              <option value="have">On</option>
              <option value="want">Otsivad</option>
              <option value="trade">Vahetuseks</option>
            </select>
          </div>
        </div>

        <div id="blueprintList" class="blueprint-list"></div>
        <div id="emptyState" class="empty-state" style="display:none;">
          <span>◎</span><br />
          Nimekiri on tühi. Lisa vasakul mõned blueprintid ja need ilmuvad siia kõigile.
        </div>
      </section>
    </div>

    <footer>
      <div>Andmed hoitakse ühes Firestore andmebaasis. Kõik sama lehe külastajad näevad sama nimekirja.</div>
      <div>Soovitus: jaga linki ainult oma sõprade ringis – eraldi sisse­logimist ei ole.</div>
    </footer>
  </div>

  <!-- Firebase skriptid (CDN) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

  <script>
    // 1) LISA SIIA OMA FIREBASE KONFIG
    // Firebase Console -> Project settings -> Your apps -> Web app
    const firebaseConfig = {
      apiKey: "SINU_API_KEY",
      authDomain: "SINU_PROJECT_ID.firebaseapp.com",
      projectId: "SINU_PROJECT_ID",
      storageBucket: "SINU_PROJECT_ID.appspot.com",
      messagingSenderId: "SINU_SENDER_ID",
      appId: "SINU_APP_ID"
    };

    // Firebase init ja Firestore
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const colRef = db.collection("arc_raiders_blueprints_shared");

    // Valik ARC Raiders blueprint nimesid autocomplete jaoks (mitte täielik list)
    const KNOWN_BLUEPRINTS = [
      "Anvil Blueprint",
      "Anvil Splitter Blueprint",
      "Aphelion Rifle Blueprint",
      "Bettina Blueprint",
      "Bobcat Blueprint",
      "Equalizer Blueprint",
      "Jupiter Blueprint",
      "Light Gun Parts Blueprint",
      "Medium Gun Parts Blueprint",
      "Heavy Gun Parts Blueprint",
      "Battery Blueprint",
      "Fireball Burner Blueprint",
      "Showstopper Blueprint",
      "Silencer I Blueprint",
      "Silencer II Blueprint",
      "Smoke Grenade Blueprint",
      "Stable Stock II Blueprint",
      "Stable Stock III Blueprint",
      "Tactical Mk. 3 Blueprint",
      "Tagging Grenade Blueprint",
      "Torrente Blueprint",
      "Trigger ‘Nade Blueprint",
      "Wolfpack Blueprint",
      "Heavy Fuze Grenade Blueprint",
      "Venator Blueprint",
      "Processor Blueprint",
      "Advanced ARC Powercell Blueprint"
    ];

    const datalistEl = document.getElementById("blueprintNames");
    KNOWN_BLUEPRINTS.forEach((name) => {
      const opt = document.createElement("option");
      opt.value = name;
      datalistEl.appendChild(opt);
    });

    /** Kohalik vahemälu UI jaoks (andmed tulevad Firestore'ist) */
    let blueprints = [];

    const form = document.getElementById("blueprintForm");
    const listEl = document.getElementById("blueprintList");
    const emptyStateEl = document.getElementById("emptyState");

    const statTotalEl = document.getElementById("statTotal");
    const statHaveEl = document.getElementById("statHave");
    const statWantEl = document.getElementById("statWant");
    const statTradeEl = document.getElementById("statTrade");

    const filterSearchEl = document.getElementById("filterSearch");
    const filterStatusEl = document.getElementById("filterStatus");

    function rarityClass(r) {
      switch (r) {
        case "rare":
          return "rarity-rare";
        case "epic":
          return "rarity-epic";
        case "legendary":
          return "rarity-legendary";
        default:
          return "rarity-common";
      }
    }

    function rarityLabel(r) {
      switch (r) {
        case "rare":
          return "haruldane";
        case "epic":
          return "eepiline";
        case "legendary":
          return "legendaarne";
        default:
          return "tavaline";
      }
    }

    function statusLabel(s) {
      if (s === "have") return "on";
      if (s === "want") return "otsivad";
      if (s === "trade") return "vahetuseks";
      return s;
    }

    function statusClass(s) {
      return s === "want"
        ? "status-want"
        : s === "trade"
        ? "status-trade"
        : "status-have";
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function createCard(bp) {
      const card = document.createElement("article");
      card.className = "card";
      card.dataset.id = bp.id;

      const notes = bp.notes && bp.notes.trim().length > 0 ? bp.notes.trim() : "";
      const rarLabel = rarityLabel(bp.rarity || "common");

      card.innerHTML = `
        <div class="card-header">
          <div>
            <div class="bp-name">${escapeHtml(bp.name)}</div>
            <div class="bp-meta">
              <span class="bp-chip ${rarityClass(bp.rarity)}">${escapeHtml(rarLabel)}</span>
            </div>
          </div>
          <div class="status-pill ${statusClass(bp.status)}">
            <span class="status-dot"></span>
            <span>${statusLabel(bp.status)}</span>
          </div>
        </div>
        <div class="bp-notes ${notes ? "" : "empty"}">
          ${
            notes
              ? escapeHtml(notes)
              : "Märkmeid pole. Vajuta MUUDA, et lisada lisainfo või vahetuse tingimused."
          }
        </div>
        <div class="bp-footer">
          <div class="owner">
            ${
              bp.owner && bp.owner.trim()
                ? `<span>Kasutaja: <strong>${escapeHtml(bp.owner)}</strong></span>`
                : `<span><strong>Kasutaja märkimata</strong></span>`
            }
          </div>
          <div class="card-actions">
            <button class="btn-ghost" data-action="edit">
              <span>✎</span> MUUDA
            </button>
            <button class="btn-ghost btn-danger" data-action="delete">
              <span>✕</span> KUSTUTA
            </button>
          </div>
        </div>
      `;

      return card;
    }

    function applyFilters() {
      const q = filterSearchEl.value.trim().toLowerCase();
      const status = filterStatusEl.value;

      return blueprints.filter((bp) => {
        if (status !== "all" && bp.status !== status) return false;

        if (q) {
          const haystack = (
            bp.name +
            " " +
            (bp.notes || "") +
            " " +
            (bp.owner || "")
          ).toLowerCase();
          if (!haystack.includes(q)) return false;
        }
        return true;
      });
    }

    function updateStats() {
      const total = blueprints.length;
      const have = blueprints.filter((b) => b.status === "have").length;
      const want = blueprints.filter((b) => b.status === "want").length;
      const trade = blueprints.filter((b) => b.status === "trade").length;

      statTotalEl.textContent = total;
      statHaveEl.textContent = have;
      statWantEl.textContent = want;
      statTradeEl.textContent = trade;
    }

    function render() {
      const filtered = applyFilters();
      listEl.innerHTML = "";

      if (filtered.length === 0) {
        emptyStateEl.style.display = "block";
      } else {
        emptyStateEl.style.display = "none";
        filtered
          .slice()
          .sort((a, b) => (b.created || 0) - (a.created || 0))
          .forEach((bp) => {
            const card = createCard(bp);
            listEl.appendChild(card);
          });
      }

      updateStats();
    }

    // Reaalajas kuulaja – kui keegi midagi lisab/muudab/kustutab, uuendame listi
    colRef.orderBy("created", "desc").onSnapshot((snapshot) => {
      const arr = [];
      snapshot.forEach((doc) => {
        const data = doc.data();
        arr.push({
          id: doc.id,
          name: data.name || "",
          rarity: data.rarity || "common",
          status: data.status || "have",
          owner: data.owner || "",
          notes: data.notes || "",
          created: data.created ? data.created.toMillis() : 0,
        });
      });
      blueprints = arr;
      render();
    });

    // Uue blueprinti lisamine
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = document.getElementById("name").value.trim();
      const rarity = document.getElementById("rarity").value || "common";
      const status = document.getElementById("status").value || "have";
      const owner = document.getElementById("owner").value.trim();
      const notes = document.getElementById("notes").value.trim();

      if (!name) {
        alert("Palun sisesta blueprinti nimi.");
        return;
      }

      try {
        await colRef.add({
          name,
          rarity,
          status,
          owner,
          notes,
          created: firebase.firestore.FieldValue.serverTimestamp(),
        });
        form.reset();
      } catch (err) {
        console.error("Lisamine ebaõnnestus:", err);
        alert("Midagi läks valesti blueprinti salvestamisel.");
      }
    });

    // MUUDA / KUSTUTA nupud
    listEl.addEventListener("click", async (e) => {
      const btn = e.target.closest("button[data-action]");
      if (!btn) return;

      const action = btn.dataset.action;
      const card = btn.closest(".card");
      if (!card) return;
      const id = card.dataset.id;

      if (action === "delete") {
        if (confirm("Kas kustutada see blueprint ühisest nimekirjast?")) {
          try {
            await colRef.doc(id).delete();
          } catch (err) {
            console.error("Kustutamine ebaõnnestus:", err);
            alert("Kustutamine ebaõnnestus.");
          }
        }
      } else if (action === "edit") {
        const bp = blueprints.find((b) => b.id === id);
        if (!bp) return;

        const newStatusRaw = prompt(
          "Uus olek (on / otsivad / vahetuseks või have / want / trade):",
          statusLabel(bp.status)
        );
        if (!newStatusRaw) return;

        const normalized = newStatusRaw.toLowerCase().trim();
        let newStatus;
        if (normalized === "on") newStatus = "have";
        else if (normalized === "otsivad") newStatus = "want";
        else if (normalized === "vahetuseks") newStatus = "trade";
        else if (["have", "want", "trade"].includes(normalized)) newStatus = normalized;
        else {
          alert("Vigane olek. Kasuta: on / otsivad / vahetuseks (või have / want / trade).");
          return;
        }

        const newNotes = prompt(
          "Märkmed (jäta tühjaks, et tühjendada):",
          bp.notes || ""
        );
        const newOwner = prompt(
          "Kasutaja:",
          bp.owner || ""
        );

        try {
          await colRef.doc(id).update({
            status: newStatus,
            notes: newNotes !== null ? newNotes.trim() : bp.notes,
            owner: newOwner !== null ? newOwner.trim() : bp.owner,
          });
        } catch (err) {
          console.error("Muutmine ebaõnnestus:", err);
          alert("Muutmine ebaõnnestus.");
        }
      }
    });

    [filterSearchEl, filterStatusEl].forEach((el) => {
      el.addEventListener("input", render);
      el.addEventListener("change", render);
    });
  </script>
</body>
</html>
